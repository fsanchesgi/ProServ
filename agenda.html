<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>ProServ | Agenda</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./style.css">

  <style>
    body {
      font-family: Inter, sans-serif;
      background: #f9fafb;
      margin: 0;
      color: #111827;
    }

    header {
      background: #111827;
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    header .container {
      max-width: 100%;
      margin: 0;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header nav a {
      color: #fff;
      text-decoration: none;
      margin-right: 1.5rem;
      font-weight: 500;
    }

    header nav a.active {
      border-bottom: 2px solid #4f46e5;
    }

    header nav button {
      background: #4f46e5;
      border: none;
      color: #fff;
      padding: .5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
    }

    .dashboard-page {
      max-width: 1200px;
      margin: 2.5rem auto;
      padding: 0 2rem;
    }

    .dashboard-header h1 {
      margin: 0;
      font-size: 2rem;
    }

    .dashboard-header p {
      margin: .25rem 0 2rem;
      color: #6b7280;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 2rem;
    }

    .dashboard-card {
      background: #fff;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.05);
    }

    .agenda-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .agenda-list li {
      background: #f3f4f6;
      border-radius: 8px;
      padding: .75rem 1rem;
      margin-bottom: .75rem;
    }

    .actions button {
      margin-top: .5rem;
      border: none;
      padding: .4rem .75rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: .85rem;
      background: #2563eb;
      color: #fff;
    }

    small {
      color: #6b7280;
      display: block;
      margin-top: .25rem;
    }
  </style>
</head>

<body>

<header>
  <div class="container">
    <img src="./images/logo.png" height="80">
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="agenda.html" class="active">Agenda</a>
      <button id="logoutBtn">Sair</button>
    </nav>
  </div>
</header>

<section class="dashboard-page">
  <div class="dashboard-header">
    <h1>ðŸ“… Agenda</h1>
    <p>Gerencie seus atendimentos</p>
  </div>

  <div class="cards-grid">
    <div class="dashboard-card">
      <h3>Atendimentos</h3>
      <ul id="lista" class="agenda-list"></ul>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="./supabase.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  const lista = document.getElementById("lista");
  const logoutBtn = document.getElementById("logoutBtn");

  const { data: auth } = await supabase.auth.getUser();
  if (!auth.user) {
    location.href = "index.html";
    return;
  }
  const user = auth.user;

  logoutBtn.onclick = async () => {
    await supabase.auth.signOut();
    location.href = "index.html";
  };

  function formatarDataHora(dataISO, hora) {
    const data = new Date(dataISO);
    const dia = String(data.getDate()).padStart(2, "0");
    const mes = String(data.getMonth() + 1).padStart(2, "0");
    const ano = data.getFullYear();

    return `${dia}/${mes}/${ano} Ã s ${hora.slice(0,5)}`;
  }

  function textoLembrete(valor) {
    if (!valor || valor === 0) return "Sem lembrete";
    if (valor === 24) return "24 horas antes";
    if (valor === 2) return "2 horas antes";
    return `${valor} horas antes`;
  }

  async function carregarAgenda() {
    lista.innerHTML = "";

    const { data } = await supabase
      .from("agendamentos")
      .select("*")
      .eq("usuario_id", user.id)
      .order("data_agendamento");

    data.forEach(a => {
      lista.innerHTML += `
        <li>
          <strong>${a.cliente_nome}</strong>
          <small>${formatarDataHora(a.data_agendamento, a.hora)}</small>
          <small>Lembrete: ${textoLembrete(a.lembrete_horas)}</small>
        </li>
      `;
    });
  }

  carregarAgenda();
});
</script>

</body>
</html>
